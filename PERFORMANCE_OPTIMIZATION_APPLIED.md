# ì„±ëŠ¥ ìµœì í™” ì ìš© ì™„ë£Œ (2025-12-15)

## âœ… ì ìš©ëœ ê°œì„ ì‚¬í•­

### 1. íƒ€ì„ì•„ì›ƒ ë‹¨ì¶• (20ì´ˆ â†’ 5ì´ˆ)
- **íŒŒì¼**: `lib/supabase/client.ts:8`
- **ë³€ê²½**: Supabase fetch íƒ€ì„ì•„ì›ƒ 20ì´ˆ â†’ 5ì´ˆ
- **íš¨ê³¼**: ë¬¸ì œë¥¼ ë¹¨ë¦¬ ë°œê²¬, ì‚¬ìš©ì ëŒ€ê¸° ì‹œê°„ ê°ì†Œ

### 2. RPC í•¨ìˆ˜ ê°œì„  - content í•„ë“œ ì œì™¸
- **íŒŒì¼**: `optimize_posts_fetching.sql`
- **ë³€ê²½**:
  - `get_paginated_posts` í•¨ìˆ˜ì—ì„œ content í•„ë“œ ì œê±°
  - read_time íƒ€ì… ìˆ˜ì • (INT â†’ TEXT)
  - location í•„ë“œ ì¶”ê°€
- **íš¨ê³¼**: ëª©ë¡ ì¡°íšŒ ì‹œ ë¶ˆí•„ìš”í•œ ë°ì´í„° ì „ì†¡ ë°©ì§€ (ê²Œì‹œë¬¼ë‹¹ ìˆ˜KB ~ ìˆ˜MB ì ˆì•½)

### 3. ìƒˆ RPC í•¨ìˆ˜ ìƒì„±
- **íŒŒì¼**: `create_additional_rpc_functions.sql` (ìƒˆ íŒŒì¼)
- **í•¨ìˆ˜**:
  1. `get_latest_posts_by_category(category_id, limit)` - ì¹´í…Œê³ ë¦¬ë³„ ìµœì‹  ê²Œì‹œê¸€
  2. `get_featured_posts(limit)` - Featured ê²Œì‹œê¸€
- **íš¨ê³¼**: `sn_posts_full` VIEW ì‚¬ìš© ì¤‘ë‹¨, JOIN ì—°ì‚° ìµœì í™”

### 4. API í•¨ìˆ˜ ìˆ˜ì •
- **íŒŒì¼**: `lib/api/posts.ts`
- **ë³€ê²½ëœ í•¨ìˆ˜**:
  1. `getPosts()` - withRetryAndTimeout ì ìš© (íƒ€ì„ì•„ì›ƒ 5ì´ˆ)
  2. `getLatestPostsByCategory()` - VIEW ëŒ€ì‹  RPC ì‚¬ìš© (íƒ€ì„ì•„ì›ƒ 18ì´ˆ â†’ 5ì´ˆ)
  3. `getFeaturedPosts()` - VIEW ëŒ€ì‹  RPC ì‚¬ìš© (íƒ€ì„ì•„ì›ƒ 18ì´ˆ â†’ 5ì´ˆ)
- **íš¨ê³¼**: ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬, ì¬ì‹œë„ ë¡œì§, ë¹ ë¥¸ íƒ€ì„ì•„ì›ƒ

### 5. ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ìµœì í™”
- **íŒŒì¼**: `lib/api/categories.ts:91`
- **ë³€ê²½**: `getCategoryBySlug()` íƒ€ì„ì•„ì›ƒ 15ì´ˆ â†’ 5ì´ˆ
- **íš¨ê³¼**: ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ë¹ ë¥¸ ê°ì§€

### 6. ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€ (ì‚¬ìš©ì ì ìš© ì™„ë£Œ)
- ì´ 6ê°œ ë³µí•© ì¸ë±ìŠ¤ ìƒì„±
- íš¨ê³¼: ì¿¼ë¦¬ ì„±ëŠ¥ ëŒ€í­ í–¥ìƒ

---

## ğŸš€ ë°°í¬ ì ˆì°¨

### 1ë‹¨ê³„: SQL ì‹¤í–‰ (Supabase ëŒ€ì‹œë³´ë“œ)

ë‹¤ìŒ 2ê°œ SQL íŒŒì¼ì„ **ìˆœì„œëŒ€ë¡œ** ì‹¤í–‰:

```bash
# 1. RPC í•¨ìˆ˜ ì—…ë°ì´íŠ¸ (ê¸°ì¡´)
optimize_posts_fetching.sql

# 2. ìƒˆ RPC í•¨ìˆ˜ ìƒì„±
create_additional_rpc_functions.sql
```

**ì‹¤í–‰ ë°©ë²•**:
1. Supabase ëŒ€ì‹œë³´ë“œ ì ‘ì†
2. SQL Editor ë©”ë‰´ ì´ë™
3. íŒŒì¼ ë‚´ìš© ë³µì‚¬ â†’ ë¶™ì—¬ë„£ê¸° â†’ Run

**í™•ì¸**:
```sql
-- RPC í•¨ìˆ˜ ëª©ë¡ í™•ì¸
SELECT routine_name, routine_type
FROM information_schema.routines
WHERE routine_schema = 'public'
AND routine_name LIKE '%post%'
ORDER BY routine_name;

-- ê²°ê³¼ì— ë‹¤ìŒ í•¨ìˆ˜ë“¤ì´ ìˆì–´ì•¼ í•¨:
-- get_paginated_posts
-- get_posts_count
-- get_latest_posts_by_category (ìƒˆë¡œ ì¶”ê°€)
-- get_featured_posts (ìƒˆë¡œ ì¶”ê°€)
```

### 2ë‹¨ê³„: ì½”ë“œ ë°°í¬

```bash
# Git ì»¤ë°‹ ë° í‘¸ì‹œ
git add .
git commit -m "feat: ì„±ëŠ¥ ìµœì í™” ì ìš© (íƒ€ì„ì•„ì›ƒ ë‹¨ì¶•, RPC ê°œì„ , content ì œì™¸)"
git push

# ë°°í¬ (Vercel ë“±)
# ìë™ ë°°í¬ ì„¤ì • ì‹œ pushë§Œìœ¼ë¡œ ë°°í¬ë¨
```

### 3ë‹¨ê³„: ë°°í¬ í›„ í™•ì¸

**ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ë¡œ í™•ì¸**:
1. F12 â†’ Network íƒ­
2. ì•¼ìƒí™”ì¼ì§€, ë‚˜ë¬´ì§„ë‹¨, ì•„ì¹´ì´ë¸Œ í˜ì´ì§€ ë°©ë¬¸
3. API í˜¸ì¶œ í™•ì¸:
   - `get_paginated_posts` í˜¸ì¶œ ì‹œê°„: **1-3ì´ˆ ì´ë‚´** (ëª©í‘œ)
   - `get_latest_posts_by_category` í˜¸ì¶œ ì‹œê°„: **1-2ì´ˆ ì´ë‚´**
   - Response í¬ê¸°: ì´ì „ë³´ë‹¤ 50-90% ê°ì†Œ (content ì œì™¸ íš¨ê³¼)

**ì½˜ì†” ë¡œê·¸ í™•ì¸**:
```javascript
// ì •ìƒ ì¼€ì´ìŠ¤
âœ“ ë¡œë”© ì™„ë£Œ: 12ê°œ (ì´ 50ê°œ)

// íƒ€ì„ì•„ì›ƒ ì¼€ì´ìŠ¤ (5ì´ˆ ì´ˆê³¼)
âš ï¸ API í˜¸ì¶œ ì‹¤íŒ¨ (ì‹œë„ 1/4) - 2000ms í›„ ì¬ì‹œë„...
Supabase ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (5000ms)
```

---

## ğŸ“Š ì˜ˆìƒ ì„±ëŠ¥ ê°œì„ 

| í•­ëª© | ë³€ê²½ ì „ | ë³€ê²½ í›„ | ê°œì„ ìœ¨ |
|------|---------|---------|--------|
| ëª©ë¡ ì¡°íšŒ ì‘ë‹µ ì‹œê°„ | 5-20ì´ˆ | 1-3ì´ˆ | **70-85% ê°ì†Œ** |
| ì‘ë‹µ í¬ê¸° (ê²Œì‹œë¬¼ 12ê°œ) | 500KB-2MB | 50-200KB | **50-90% ê°ì†Œ** |
| íƒ€ì„ì•„ì›ƒ ëŒ€ê¸° ì‹œê°„ | 20ì´ˆ | 5ì´ˆ | **75% ê°ì†Œ** |
| VIEW ì‚¬ìš© | 2íšŒ (ë¬´ê±°ì›€) | 0íšŒ | **100% ì œê±°** |

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. TypeScript íƒ€ì… ì˜¤ë¥˜ ê°€ëŠ¥ì„±
RPC í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ê°€ ë³€ê²½ë˜ì–´ íƒ€ì… ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```typescript
// lib/types/database.types.tsì—ì„œ PostFull íƒ€ì… í™•ì¸
export interface PostFull {
  // content?: string; // ì œê±°ë¨
  location?: string;   // ì¶”ê°€ë¨
  read_time?: string;  // number â†’ string ë³€ê²½
  // ...
}
```

ë¹Œë“œ ì˜¤ë¥˜ ë°œìƒ ì‹œ íƒ€ì… ì •ì˜ë¥¼ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.

### 2. í˜ì´ì§€ë„¤ì´ì…˜ total count ë¬¸ì œ
í˜„ì¬ `getPosts()`ì˜ `total` ê°’ì´ ì •í™•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ì„ì‹œ ê³„ì‚° ì‚¬ìš©).

**ì¶”í›„ ê°œì„  í•„ìš”**:
```typescript
// lib/api/posts.ts:258-261
// TODO: get_posts_count RPCë¥¼ ë³‘ë ¬ í˜¸ì¶œí•˜ì—¬ ì •í™•í•œ ì´ ê°œìˆ˜ ë°˜í™˜
const [postsData, countData] = await Promise.all([
  supabase.rpc('get_paginated_posts', ...),
  supabase.rpc('get_posts_count', ...)
]);
```

### 3. 5ì´ˆ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì¸í•œ ì—ëŸ¬ ì¦ê°€ ê°€ëŠ¥
ì²˜ìŒì—ëŠ” íƒ€ì„ì•„ì›ƒ ì—ëŸ¬ê°€ ë” ìì£¼ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì •ìƒ**: ë³µí•© ì¸ë±ìŠ¤ íš¨ê³¼ë¡œ 1-3ì´ˆ ë‚´ ì‘ë‹µ
- **ë¹„ì •ìƒ**: 5ì´ˆ ì´ˆê³¼ â†’ ì¿¼ë¦¬ ìµœì í™” í•„ìš” (ì¸ë±ìŠ¤ ë¯¸ì ìš©, ì¿¼ë¦¬ ë¬¸ì œ)

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì—ëŸ¬: "function get_latest_posts_by_category does not exist"
â†’ `create_additional_rpc_functions.sql` ì‹¤í–‰ ì•ˆ ë¨. 1ë‹¨ê³„ ë‹¤ì‹œ ì‹¤í–‰.

### ì—ëŸ¬: "column 'content' does not exist"
â†’ íƒ€ì… ì •ì˜ì™€ ì‹¤ì œ RPC ì‘ë‹µ ë¶ˆì¼ì¹˜. `PostFull` íƒ€ì…ì—ì„œ `content` ì œê±° í•„ìš”.

### ì—¬ì „íˆ ëŠë¦¼ (5ì´ˆ ì´ìƒ)
1. ì¸ë±ìŠ¤ ì ìš© í™•ì¸:
   ```sql
   SELECT indexname FROM pg_indexes WHERE tablename = 'sn_posts';
   ```
2. ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš í™•ì¸:
   ```sql
   EXPLAIN ANALYZE SELECT * FROM get_paginated_posts(NULL, NULL, NULL, 'published', NULL, 'latest', 1, 12);
   ```

---

## ğŸ“ ë‹¤ìŒ ê°œì„  ì‚¬í•­ (ìš°ì„ ìˆœìœ„)

1. **í˜ì´ì§€ë„¤ì´ì…˜ total count ì •í™•ë„ ê°œì„ ** (high)
   - `get_posts_count` RPC ë³‘ë ¬ í˜¸ì¶œ

2. **ìºì‹± ë„ì…** (medium)
   - React Query, SWR ë“±ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ìºì‹±
   - ë™ì¼ í˜ì´ì§€ ì¬ë°©ë¬¸ ì‹œ API í˜¸ì¶œ ë¶ˆí•„ìš”

3. **Incremental Static Regeneration (ISR)** (low)
   - Next.js App Routerì˜ ISRë¡œ ì„œë²„ ì‚¬ì´ë“œ ìºì‹±
   - ì •ì  í˜ì´ì§€ ìƒì„±ìœ¼ë¡œ ì´ˆê¸° ë¡œë”© ì†ë„ ê°œì„ 

4. **ì´ë¯¸ì§€ ìµœì í™”** (low)
   - Next.js Image ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
   - WebP í¬ë§·, lazy loading
